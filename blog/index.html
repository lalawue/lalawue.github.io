<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
  <head>
    <title>Sucha's Blog - Welcome</title>
    <meta name="generator" content="MarkdownProjectCompositor.lua" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="author" content="Sucha" />
    <meta name="keywords" content="suchang, programming, GNU, Linux, Emacs, Lua" />
    <meta name="description" content="Sucha's blog" />
    <link rev="made" href="mailto:suchaaa@gmail.com" />
    <link rel="shortcut icon" href="../images/ico.png" />
    <link rel="stylesheet" type="text/css" href="../styles/blog.css" />
    <link rel="stylesheet" type="text/css" href="../styles/prism.min.css" />
  </head>
  <body>
    <div id="body">
      <div id="text">
	   <!-- Page published by cmark-gfm begins here --><h1>Sucha's Blog ~ Welcome</h1><div class="date">22年6月26日 周日 15:02</div>
<h2>MoocHelper 更新到 0.2.16</h2>
<p>昨天说到 <a href="https://github.com/Tencent/LuaHelper">LuaHelper</a> 已经更新到了 0.2.16，今天我也同步将 <a href="https://github.com/lalawue/MoocHelper">MoocHelper</a> 更新上去了，主要的改动有</p>
<ul>
<li>当方法里local与self同名时，self指向正确的table</li>
</ul>
<p>例子是</p>
<pre><code class="language-lua">local foo = {}

function foo:test()
    local foo = {}
    self:bar()
end

function foo:bar()
end
</code></pre>
<p>之前当 hover 到 test() 函数中的 self:bar() 时，self 其实指向的是函数内的 local variable foo，而实际 Lua 语义是指向运行当前 function 的 table，毕竟 self 是作为当前 function 第一个参数传递进来的。</p>
<p>moocscript 的处理还特别一点，因为其 class/struct 是通过拼凑 AssignStat 来实现的，这种 <code>:</code> 函数在 class/struct 里面其实是实例函数，语法跟 Lua 不一样，没有 table name 前缀，得特别处理一下。</p>
<p>这里的特别处理是，需要在当前 AST 的位置，一直寻找 parent scope 到最近的 class scope，如果存在，拿到外层 local variable map 的同名变量定义（如上面例子的 <code>foo</code>），将变量定义的 Loc 作为 self 的 varStruct 描述，后面这个 Loc 的逻辑跟 Lua 侧是一样的。</p>
<p>大概这样吧。</p>
<div class="category"><a href="CategoryProgramming.html">CategoryProgramming</a> / <a href="2022-06.html#p2">Permalink</a></div>

<div class="date">22年6月25日 周六 22:30</div>
<h2>MoocHelper 更新到 0.2.15</h2>
<p>这个其实也是 5 月份的事情，之前也说过，因为一直都有用 <a href="https://github.com/lalawue/mooncake">MoonCake</a>，自然就少不了
LSP 的支持。</p>
<p>这次是同步了 <a href="https://github.com/Tencent/LuaHelper">LuaHelper</a> 的更新，自己这边添加了另外一些功能，比如对于非工程路径的支持，
hover 到 require 库时，可以寻找过去，另外就是函数内部的 local 变量，我是默认不展示在 outline 的，我觉得这些变量太烦了。</p>
<p>另外刚看到 upstream 已经到了 0.2.16 了，等我后面有空再同步一下吧。</p>
<div class="category"><a href="CategoryProgramming.html">CategoryProgramming</a> / <a href="2022-06.html#p1">Permalink</a></div>

<div class="date">22年6月25日 周六 21:15</div>
<h2>新台式电脑</h2>
<p>上个月买了新的台式电脑，用了一个多月后，感觉还行吧。当时换台式机想了挺久，主要是之前那台 i5 一直停留在 10.12 升不了系统，
也用了好多年了，考虑再三，还是先换了吧。</p>
<p>之前还犹豫要不要买 Apple Silicon M1 的，因为工作中用的就是 M1，所以也算了解。最大 16G 的内存是软肋，即便是工作，
勉勉强强够吧，CPU 倒是还不错，这一两年都足够了其实，GPU 不参与评测。不过如果配上 512G 的 SSD，价格就很不香了。</p>
<p>还有因为平时绝大部分时间用的是 M1，真的不大想下班再用 M1 了，也是一个因素。</p>
<p>于是搞了一台黑苹果，CPU 用了 i7-12700，GPU 是基本入门款，因为平时极少玩游戏，反而内存直接到了 64G。规格上去之后，
机箱体积也小不了，虽然还是 Mini-ITX，还挺重的。</p>
<p>各种原因，显示屏还是 1080P 的，已经用了有 8 年了，因为租住的地方比较小，如果换成 27 寸 4K，感觉塞不下（真的有点挤），
而 M1 对 2K 屏幕支持很弱，我试过即便用了 GitHub 上的 HiDPI 脚本，还是不尽如人意，要上就只能上 4K，所以不如先不换。</p>
<p>直接上 64G 内存的原因，是之前编译一些稍微大一点的 Swift 工程，加上开了其他浏览器什么的之后，感觉内存都快满了情况，
所以不如一步到位 64G 了。</p>
<p>现在的感觉，性能毫无疑问是过剩的，结论我现在确实只是个参数党。</p>
<div class="category"><a href="CategoryLife.html">CategoryLife</a> / <a href="2022-06.html#p0">Permalink</a></div>

<div class="date">22年5月14日 周日 23:49</div>
<h2>cmark-gfm 静态链接</h2>
<p>默认情况下，<a href="https://github.com/github/cmark-gfm">cmark-gfm</a> 是通过 cmake 编译为动态库的方式，但其实可以通过设置</p>
<pre><code class="language-bash">$ cmake -DCMARK_SHARED=OFF ../
$ make
</code></pre>
<p>配置为静态链接，少一个依赖，如果能修改一下再链接到 <a href="https://musl.libc.org/">musl libc</a>，那就更进一步，不受限于系统版本了哈哈。</p>
<p>不过即便使用系统的 libc，也已经很不错了，毕竟也是向后兼容的，不担心未来的使用</p>
<pre><code class="language-bash">$ otool -L src/cmark-gfm
src/cmark-gfm:
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1311.100.3)
</code></pre>
<p>如果是动态链接的话，会是下面这样</p>
<pre><code class="language-bash">$ otool -L src/cmark-gfm
src/cmark-gfm:
	@rpath/libcmark-gfm-extensions.0.29.0.gfm.3.dylib (compatibility version 0.29.0, current version 0.29.0)
	@rpath/libcmark-gfm.0.29.0.gfm.3.dylib (compatibility version 0.29.0, current version 0.29.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1311.100.3)
</code></pre>
<p>编译后当然不会放到系统目录，而是随便丢到一个 PATH 能访问到的目录下用就好了。</p>
<div class="category"><a href="CategoryProgramming.html">CategoryProgramming</a> / <a href="2022-05.html#p3">Permalink</a></div>

<div class="date">22年5月14日 周日 21:16</div>
<h2>倾我所有去生活</h2>
<p>前一段时间在多抓鱼上买了这本二手书，之所以买，是因为一篇豆瓣上的文章<a href="https://www.douban.com/group/topic/29630912/">《没有什么必须要说》</a><sup><a href="#fnc1">1</a></sup>，作者苏美。</p>
<p>短篇记载的是一位女儿父亲的一生，从荣耀到低沉，从生机勃勃到病患缠身黯然神伤，这篇短篇的另外一条线是女儿跟父亲的关系，她们的关系算是父亲境遇的反映。</p>
<p>父亲年轻时是一位帕米尔高原的边防战士，在一片白茫茫的雪海里面恪尽职守，直来直往，追雪兔、打雪狼，莽莽撞撞，不言轻伤。直来直往的性格，也体现在跟女儿的关系上面。父亲威严，不允许孩子反驳，女儿为此挨了不少耳光。</p>
<p>画风一转。</p>
<p>可这又有什么用呢，父亲退伍转业，突然患病后身体状况急转而下，为了救命，不得不躺在手术台上，身体被医生划开，插满了管子，任人摆布。</p>
<p>冰天雪地上顶天立地的男儿不在，只剩下无法自理，得依靠儿女度过难关的一位凄惨病人，当时父亲才 49 岁。</p>
<p>父亲状态转好，但在更为复杂、广大的社会丛林里里的小角色，随时间流逝，生计慢慢成了问题，不得不依靠一些之前的狐朋狗友接济。</p>
<p>这位狐朋狗友丢给了父亲一份差事，表面上是管个小公司，实际上是帮摆平这位前辈的一个二奶，二奶啥都不懂，公司帐很乱。</p>
<p>女儿看到父亲这般情景，是恨不得给父亲这位朋友一个耳光。可这位朋友也算是女儿从小就认识的长辈，只能作罢。</p>
<p>故事从高光开局，进入接近死亡的威胁，身体转好的递进，来到社会丛林复杂关系的碾压，然后进入了尾声。</p>
<p>父亲年迈，在厨房里面为儿辈准备晚餐，唠唠叨叨，完全融入了家庭生活。</p>
<p><sup>[<a id="fnc1">1</a>]</sup> 被删帖了，禁止网站 JS 能看到</p>
<div class="category"><a href="CategoryReading.html">CategoryReading</a> / <a href="2022-05.html#p2">Permalink</a></div>

<div class="date">22年5月8日 周日 23:16</div>
<h2>Parallels 和 VirtualBox</h2>
<p>用 <a href="https://github.com/lalawue/cincau">cincau</a> 开发了一个小站点，而 cincau 是支持使用定制的 <a href="https://github.com/ers35/luastatic">luastatic</a> 打包的，目标系统是 Linux。因为容器什么的我还不熟悉，所以其实最终拿到的是 luajit 包含了所有脚本 C 数据 + 一堆 shared library，tar 到一起的结果。</p>
<p>像上面说的，因为没搞容器，所以还是需要通过虚拟机上的 Linux 系统生成目标二进制，之前在 Mac 上我用的是 Parallels，也挺方便的，但是 Parallels 贵啊，非正规的也不好搞，这次新机器上的 Parallels 好不容易安装好了，结果网络怎么都用不了，我是相当郁闷，花了几个小时还搞不定，但是又确实不想花钱升级了。</p>
<p>于是试了一下 VirtualBox，发现同样一个版本，低至 10.12 的 Mac 也能安装，新 Mac 系统上面创建的虚拟机文件，拷贝过来后，直接用，不能更开心。</p>
<p>感觉不需要什么特别的配置，直接用就行，早知道我早早地使用 VirtualBox 好了，毕竟不是使用 Windows，对于虚拟化性能、3D、2D 什么我是一点都不在乎的，现在身边已经没有 Windows 机器了。</p>
<div class="category"><a href="CategoryLinux.html">CategoryLinux</a> / <a href="2022-05.html#p1">Permalink</a></div>

<div class="date">22年5月4日 周三 23:28</div>
<h2>罗浮山一日游</h2>
<p>3 号 7 点的时候，太阳已经把深圳晒得金黄，五一开头的冷雨天气正式结束，然后气温紧接着就上来了。我是计划好了去罗浮山，早买了票。</p>
<p>一路还挺顺利的，老地方惠州北站转华侨中学，为了吃到肠粉早餐，走了 3 站公交，然后上 268 到了罗浮山。</p>
<p>人巨多，门票相比之前便宜了，只要 ¥27，不知道是不是因为放假的原因。还有缆车升级了，之前一个筐 2 个人，全开放的结构，景观不能更好，就是有点危险，要脚踩加手扶着前面弹性的顶架，要不顶架会自动上翻，这种情况不敢想。拿着手机、相机拍照也得很小心，如果掉下去，要找回来估计难，没法刻缆求剑。</p>
<p>记得当时第一次坐这种缆车，看着树尖在脚底下过，风在耳边呼呼地吹，心跳有点快。</p>
<p>现在变全封闭的车厢了，挤满可以坐 8 个人，但一般只进去 6 个。运量是之前的 3 倍，然后周转速度也快了很多，排队也不焦躁了。不过单程贵了 10 块，双程现在上到 120 了。</p>
<p>人好多呀，几乎是排队上山，好多狭窄的小径，都要挤着才能过去。即便到了飞云顶，人一样多。山顶的小土堆、石头堆不见了，成了一个大土堆，之前石头堆上插着的五星红旗也不见了。</p>
<p>我是觉得罗浮山的山体好美，远看就像是拔地而起，山脉轮廓非常清晰。如果从山顶看，几个山脊各种曲线蜿蜒向下，墨绿色铺满了整座山，爱了爱了。</p>
<p>爬山中间有路过瀑布，景点叫分水坳，也许是刚停雨的原因吧，水流很大，哗哗地。旁边有卖甘蔗的，也不贵，6 块钱，我后悔只搞了一根，一边嚼着，一边看瀑布，吃完还可以洗个手冰凉一下。可惜下山路过的时候，发现卖完了。</p>
<p>晚上仍然是 268 到博罗后，转 L1A、L1B 到惠州市区。晚饭就在街边的推车小吃上，搞了牛肉杂碎煮物，还要了个煎饼果子。不过牛肉真的一般，我觉得太硬了，味道勉勉强强。</p>
<p>第二早又搞了一波肠粉，反正就是觉得比深圳的好吃，然后原路高铁返深了，排队核酸搞了快 20 分钟才出站。</p>
<div class="category"><a href="CategoryLife.html">CategoryLife</a> / <a href="2022-05.html#p0">Permalink</a></div>

<div class="date">22年4月5日 周六 01:28</div>
<h2>改进侧边栏搜索</h2>
<ul>
<li>改进了 site 和 blog 的侧边栏搜索，用的搜索引擎是 cn.bing.com</li>
<li>更改了 Yulin City Map 的地图卫星图像 URL，来源为 map.baidu.com</li>
</ul>
<p>UI 交互没变化，也是方便之后如果想从站点、博客搜索内容的话，会方便一些，不过自己测试了一下，很多内容搜索不到，应该是小站点，搜索引擎照顾不了。</p>
<p>没名气的静态网页就这样的了，😌</p>
<div class="category"><a href="CategoryThisSite.html">CategoryThisSite</a> / <a href="2022-04.html#p0">Permalink</a></div>

<div class="date">22年4月5日 周六 01:28</div>
<h2>MoocHelper 更新到 0.2.12</h2>
<p>项目地址 <a href="https://github.com/lalawue/MoocHelper">MoocHelper</a>，同时更新了 .vsix 跨平台安装包。</p>
<p>因为 LuaHelper 前段时间更新了，我也跟着将基本的代码更新上去，这次改动主要是 anotation，语法方面我觉得没有什么变化。
anotation 我用得少，所以相关改变也说不上了解。</p>
<p>另外修复了 switch case 中 case 后面 exp 的一些解析问题，之前跟 Lua EBNF 表述的 prefixexp 语法 ':' 有冲突。</p>
<p>mooncake 里 case 紧接着的 exp 可以是右值，比如 object:func1(param1):func2(param2) 是一个合法的 Lua prefixexp，
而 case 语句依赖 ':' 作为终结符，由于 Lua 不依赖空格、分行、间距来作为语法分割，因此刚刚的 exp 对于两个不同的 ':' 可以有多种解释：</p>
<pre><code class="language-lua">-- case 1
case object:
    func1(param):func2(param2)
-- case 2
case object:func1(param1):
    func2(param2)
-- case 3
case (object:func1(param1):func2(param2))
</code></pre>
<p>实际上 Lua 的 prefixexp 使用的是贪心策略，最终解析出来的是 case 3，认为 case 子句没有完结，会报语法错误。
而 mooncake 之前对这里没有定义，因此 case 1 和 case 2 都是可选的合法解释。</p>
<p>这次的修改加上了补充，认为 ':' 之后如果紧接着空格，比如 '\t'、'\n'、'\t'、'\v'，则认为是 case 语句的终结。
因此 case 1、case 2 才是 mooncake 合法的 case 语句，并且语义有区别。而 case 3 并不是合法的语句。</p>
<p>大概这样吧。</p>
<div class="category"><a href="CategoryProgramming.html">CategoryProgramming</a> / <a href="2022-04.html#p0">Permalink</a></div>

<div class="date">22年3月29日 后日 22:54</div>
<h2>深圳停摆一周</h2>
<p>深圳因为疫情整个城市停摆了一周，我所在的小区因为有密接者检测出阳性，被封了两周。</p>
<p>密接者所在的楼栋，在被封锁的 2 周内足不出户，医护都是送吃的到户；我们这些顺带的，前面 4 天，足不出户，
但是可以点外卖，医护送外卖和快递到户，4 天之后可以自己下楼拿快递。</p>
<p>好不容易解封了，感觉自己胖了一圈。</p>
<p>这两周从足不出户、足不出楼、足不出小区走过来，真的挺痛苦的，因为小区有点小，人多，又不鼓励下楼到处转，憋得太慌了。</p>
<p>好在之前做了一些准备，即便不买外卖，自热饭够一周，加上囤的面，两三周都不成问题。就是吃得确实寒碜了点，肉类不够，蔬菜也不够。</p>
<p>我是中午点外卖，晚上换着吃自热饭、方便面、竹升面等，话说竹升面挺不错的，看起来小小一卷，煮开后足够我吃的，味道也不错，
面感挺好的，没有单独的包装这点不够好。</p>
<p>我是打算手头这些方便面吃完后，搞些其他的面食试一下，尝尝鲜，因为方便面多是油炸类型的，不够健康，而且味道类似，吃多了有点腻。</p>
<p>竹升面这类看似清淡，其实可以搭配的感觉要多很多，反正我都是会煮 2 ~ 3 分钟的，方面程度来说是一样的。</p>
<p>不大想煮饭，煮饭是好吃，只是时间上耗费太多，后面等条件好些，看看再煮饭吧。</p>
<div class="category"><a href="CategoryLife.html">CategoryLife</a> / <a href="2022-03.html#p0">Permalink</a></div>

<div class="date">22年2月27日 后日 23:24</div>
<h2>本站支持代码高亮</h2>
<p>用的方案是 <a href="https://prismjs.com/">Prism</a>，cmark-gfm 本来就支持生成相关的 pre、code tag，并带上 &quot;language-css&quot; 这样的 attribute 值，那只要简单加上下面两行就好了，在项目站点上，选了几个自己觉得也许会用得比较多的语言，比如 Bash/Shell/JS/Lua/Go/Swift/Lisp，我也就大概会这么多而已吧。</p>
<pre><code class="language-html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../styles/prism.min.css&quot;&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;../js/prism.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>感觉效果很不错的，比如之前</p>
<ul>
<li><a href="../blog/2008-06.html#p1">Emacs-Lisp</a></li>
<li><a href="../blog/2021-11.html#p4">Javascript</a></li>
<li><a href="../blog/2021-11.html#p0">Ini</a></li>
<li><a href="../blog/2021-08.html#p0">Lua</a></li>
<li><a href="../blog/2020-12.html#p0">Swift</a></li>
<li><a href="../blog/2020-11.html#p0">Go</a></li>
<li><a href="../blog/2020-09.html#p1">Rust</a></li>
</ul>
<p>选的主题是 tomorrow night，跟已有的主题搭配起来也挺不错，缺点可能是 js 代码 minify 后仍然有 60k 吧。</p>
<p>不管怎么说，还有 Etag 撑着呢，另外，毕竟是存放在 github 的，算是白嫖了。</p>
<div class="category"><a href="CategoryThisSite.html">CategoryThisSite</a> / <a href="2022-02.html#p2">Permalink</a></div>
<!-- Page published by cmark-gfm ends here -->
  <div id="foot">2004-<script type="text/javascript">var d = new
	Date();document.write(d.getFullYear())</script> &copy;
	Sucha. Powered by MarkdownProjectCompositor.
  </div>
  </div><!-- text -->
  <div id="sidebar">
  </div><!-- sidebar -->
  <script type="text/javascript" src="../js/blog_sidebar.js"></script>
  <script type="text/javascript" src="../js/prism.min.js" async></script>
  </div> <!-- body -->
</body>
</html>